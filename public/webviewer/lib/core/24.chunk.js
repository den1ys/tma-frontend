/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[24],{402:function(ia,z,e){e.r(z);var fa=e(1),x=e(14),ha=e(2);ia=e(48);var da=e(32),ea=e(9);e=function(){function e(){this.init()}e.prototype.init=function(){this.c0=!1;this.ue=this.Zj=this.connection=null;this.Sp={};this.Ba=this.PB=null};e.prototype.aea=function(e){for(var w=this,r=0;r<e.length;++r){var n=e[r];switch(n.at){case "create":this.Sp[n.author]||(this.Sp[n.author]=n.aName);this.c7(n);break;case "modify":this.Ba.Tq(n.xfdf).then(function(e){w.Ba.$R(e[0])});
break;case "delete":this.Ba.Tq("<delete><id>"+n.aId+"</id></delete>")}}};e.prototype.c7=function(e){var w=this;this.Ba.Tq(e.xfdf).then(function(r){r=r[0];r.authorId=e.author;w.Ba.$R(r);w.Ba.trigger(x.a.UPDATE_ANNOTATION_PERMISSION,[r])})};e.prototype.D6=function(e,x,r){this.Zj&&this.Zj(e,x,r)};e.prototype.preloadAnnotations=function(e){this.addEventListener("webViewerServerAnnotationsEnabled",this.D6.bind(this,e,"add",{imported:!1}),{once:!0})};e.prototype.initiateCollaboration=function(w,z,r){var n=
this;if(w){n.ue=z;n.Ba=r.Ka();r.addEventListener(x.d.DOCUMENT_UNLOADED,function(){n.disableCollaboration()});n.xea(w);var f=new XMLHttpRequest;f.addEventListener("load",function(){if(200===f.status&&0<f.responseText.length)try{var h=JSON.parse(f.responseText);n.connection=exports.Sa.gfa(Object(da.h)(n.ue,"blackbox/"),"annot");n.PB=h.id;n.Sp[h.id]=h.user_name;n.Ba.gT(h.id);n.connection.rla(function(e){e.t&&e.t.startsWith("a_")&&e.data&&n.aea(e.data)},function(){n.connection.send({t:"a_retrieve",dId:w});
n.trigger(e.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[n.Sp[h.id],n.PB])},function(){n.disableCollaboration()})}catch(ba){Object(ha.g)(ba.message)}});f.open("GET",Object(da.h)(this.ue,"demo/SessionInfo.jsp"));f.withCredentials=!0;f.send();n.c0=!0;n.Ba.Sba(function(e){return n.Sp[e.Author]||e.Author})}else Object(ha.g)("Document ID required for collaboration")};e.prototype.disableCollaboration=function(){this.Zj&&(this.Ba.removeEventListener(ea.a.Events.ANNOTATION_CHANGED,this.Zj),this.Zj=null);
this.connection&&this.connection.Rn();this.Ba&&this.Ba.gT("Guest");this.init();this.trigger(e.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};e.prototype.xea=function(e){var w=this;this.Zj&&this.Ba.removeEventListener(ea.a.Events.ANNOTATION_CHANGED,this.Zj);this.Zj=function(r,n,f){return Object(fa.b)(this,void 0,void 0,function(){var h,x,y,z,aa,ca,da,ea,ha;return Object(fa.d)(this,function(ba){switch(ba.label){case 0:if(f.imported)return[2];h={t:"a_"+n,dId:e,annots:[]};return[4,w.Ba.q3()];case 1:x=
ba.ea();"delete"!==n&&(y=(new DOMParser).parseFromString(x,"text/xml"),z=new XMLSerializer);for(aa=0;aa<r.length;aa++)ca=r[aa],ea=da=void 0,"add"===n?(da=y.querySelector('[name="'+ca.Id+'"]'),ea=z.serializeToString(da),ha=null,ca.InReplyTo&&(ha=w.Ba.LE(ca.InReplyTo).authorId||"default"),h.annots.push({at:"create",aId:ca.Id,author:w.PB,aName:w.Sp[w.PB],parent:ha,xfdf:"<add>"+ea+"</add>"})):"modify"===n?(da=y.querySelector('[name="'+ca.Id+'"]'),ea=z.serializeToString(da),h.annots.push({at:"modify",
aId:ca.Id,xfdf:"<modify>"+ea+"</modify>"})):"delete"===n&&h.annots.push({at:"delete",aId:ca.Id});0<h.annots.length&&w.connection.send(h);return[2]}})})}.bind(w);this.Ba.addEventListener(ea.a.Events.ANNOTATION_CHANGED,this.Zj)};e.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return e}();Object(ia.a)(e);z["default"]=e}}]);}).call(this || window)
